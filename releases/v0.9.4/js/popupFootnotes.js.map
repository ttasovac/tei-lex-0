{
  "version": 3,
  "sources": ["../../../assets/js/popupFootnotes.js"],
  "sourcesContent": ["/* \n  This file provides popup functionality for footnotes and bibliography references\n  in the Guidelines.\n  \n  Created by Martin Holmes, 2013-07 and 2014-07, free for all for everything.\n */\n \n //Make these pointers global so we can use them everywhere.\n var footnotePopup = null;\n var footnotePopupContent = null;\n var biblFrame = null;\n\n$(document).ready(function(){\n//First we create a popup box ready to receive the footnotes.\n  footnotePopup = document.createElement('div');\n  footnotePopup.setAttribute('id', 'footnotePopup');\n  var closer = document.createElement('div');\n  closer.setAttribute('class', 'footnotePopupCloser');\n  closer.setAttribute('onclick', 'this.parentNode.style.display = \\'none\\'');\n  var x = document.createTextNode('x');\n  closer.appendChild(x);\n  footnotePopupContent = document.createElement('div');\n  footnotePopupContent.setAttribute('id', 'footnotePopupContent');\n  footnotePopup.appendChild(closer);\n  footnotePopup.appendChild(footnotePopupContent);\n  document.getElementsByTagName('body')[0].appendChild(footnotePopup);\n\n//Now we work through the links to footnotes.\n  var links = document.getElementsByTagName('a');\n  for (var i=0; i<links.length; i++){\n    if (links[i].hasAttribute(\"href\") && links[i].getAttribute('href').substring(0, 5) == '#Note'){\n      if (links[i].getAttribute('class') != 'link_return'){\n        links[i].setAttribute('onclick', 'showPopupFootnote(\\'' + links[i].getAttribute('href').substring(1) + '\\')');\n        links[i].setAttribute('href', 'javascript:void(0)');\n      }\n    }    \n  }\n  addBiblFrame();\n});\n\nfunction showPopupFootnote(footnoteId){\n  var footnote = document.getElementById(footnoteId);\n  if ((footnotePopup == null)||(footnotePopupContent == null)||(footnote == null)){\n//If something is missing, we just default to original behaviour and jump to the footnote.\n    document.location.hash = footnoteId;\n    return;\n  }\n//Otherwise, we populate the popup with the content of the footnote, and show it.\n  var cloneFootnote = footnote.cloneNode(true);\n//We need to remove the id because it'll be a duplicate.\n  cloneFootnote.setAttribute('id', '');\n//Add it to the popup.\n  clearContent(footnotePopupContent);\n  footnotePopupContent.appendChild(cloneFootnote);\n  footnotePopup.style.display = 'block';\n}\n\nfunction clearContent(targetEl){\n  if (targetEl == null){return;}\n  for (var i=targetEl.childNodes.length-1; i>-1; i--){\n    targetEl.removeChild(targetEl.childNodes[i]);\n  }\n} \n\n//Bind the escape key so that it hides the popup if it's showing.\n$(document).keyup(function(e){\n  if(e.keyCode === 27)\n    if (document.getElementById('footnotePopup').style.display == 'block'){\n      document.getElementById('footnotePopup').style.display = 'none';\n      e.preventDefault();\n      e.stopPropagation();\n    }\n});\n\n//These functions set up and handle the display of bibliographical references\n//as popups.\n\n//This function finds all links to items in the bibliography and turns them\n//into JS calls which retrieve the content which has been imported into \n//an iframe, and display it as a popup.\nfunction setupBiblPopups (){\n  var links = document.getElementsByTagName('a');\n  for (var i=0; i<links.length; i++){\n    var href = links[i].getAttribute('href');\n/*    if (href && href.substring(0, 9) == 'bibliography.html#'){\n*/      var biblId = href.substring(9, href.length);\n        links[i].setAttribute('onclick', 'showPopupBibl(\\'' + biblId + '\\')');\n        links[i].setAttribute('href', 'javascript:void(0)');\n      //}\n    }\n/*  }\n*/}\n\n//This function creates an invisible iframe and loads the BIB.html document\n//into it, so we can retrieve references from it and show them in popups.\nfunction addBiblFrame(){\n//First make sure we're not running this on the bibliography itself.\n/*    var biblDoc = new RegExp('bibliography\\.html(#.+)?$');\n    var isBibliography = biblDoc.exec(window.location);\n    if (isBibliography){return;}*/\n    biblFrame = document.createElement('iframe');\n    biblFrame.style.display = 'none';\n    biblFrame.appendChild($('#bibliography'));\n    document.getElementsByTagName('body')[0].appendChild(biblFrame);\n    \n    //biblFrame.setAttribute('src', 'bibliography.html');\n    $(biblFrame).ready(setupBiblPopups);\n}\n\n//This function shows a bibl popup. It differs slightly from the function for note\n//popups, so it is distinct.\nfunction showPopupBibl(biblId){\n  var bibl = null;\n//We have to be cautious here; some browsers block access to the iframe \n//document contents from another document, especially when running locally.\n  try{\n    bibl = biblFrame.contentDocument.getElementById(biblId);\n  }\n  catch(e){\n    document.location = 'bibliography.html#' + biblId;\n    return;\n  }\n  \n  if ((footnotePopup == null)||(footnotePopupContent == null)||(bibl == null)){\n//If something is missing, we just default to original behaviour and jump to the bibliography.\n    document.location = 'bibliography.html#' + biblId;\n    return;\n  }\n//Otherwise, we populate the popup with the content of the bibl, and show it.\n  var biblContent = bibl.innerHTML;\n//Add it to the popup.\n  clearContent(footnotePopupContent);\n  footnotePopupContent.innerHTML = biblContent;\n  footnotePopup.style.display = 'block';\n}\n\n\n\n"],
  "mappings": "MAQC,IAAIA,EAAgB,KAChBC,EAAuB,KACvBC,EAAY,KAEjB,EAAE,QAAQ,EAAE,MAAM,UAAU,CAE1BF,EAAgB,SAAS,cAAc,KAAK,EAC5CA,EAAc,aAAa,KAAM,eAAe,EAChD,IAAIG,EAAS,SAAS,cAAc,KAAK,EACzCA,EAAO,aAAa,QAAS,qBAAqB,EAClDA,EAAO,aAAa,UAAW,wCAA0C,EACzE,IAAIC,EAAI,SAAS,eAAe,GAAG,EACnCD,EAAO,YAAYC,CAAC,EACpBH,EAAuB,SAAS,cAAc,KAAK,EACnDA,EAAqB,aAAa,KAAM,sBAAsB,EAC9DD,EAAc,YAAYG,CAAM,EAChCH,EAAc,YAAYC,CAAoB,EAC9C,SAAS,qBAAqB,MAAM,EAAE,CAAC,EAAE,YAAYD,CAAa,EAIlE,QADIK,EAAQ,SAAS,qBAAqB,GAAG,EACpCC,EAAE,EAAGA,EAAED,EAAM,OAAQC,IACxBD,EAAMC,CAAC,EAAE,aAAa,MAAM,GAAKD,EAAMC,CAAC,EAAE,aAAa,MAAM,EAAE,UAAU,EAAG,CAAC,GAAK,SAChFD,EAAMC,CAAC,EAAE,aAAa,OAAO,GAAK,gBACpCD,EAAMC,CAAC,EAAE,aAAa,UAAW,sBAAyBD,EAAMC,CAAC,EAAE,aAAa,MAAM,EAAE,UAAU,CAAC,EAAI,IAAK,EAC5GD,EAAMC,CAAC,EAAE,aAAa,OAAQ,oBAAoB,GAIxDC,EAAa,CACf,CAAC,EA2BD,EAAE,QAAQ,EAAE,MAAM,SAASC,EAAE,CACxBA,EAAE,UAAY,IACX,SAAS,eAAe,eAAe,EAAE,MAAM,SAAW,UAC5D,SAAS,eAAe,eAAe,EAAE,MAAM,QAAU,OACzDA,EAAE,eAAe,EACjBA,EAAE,gBAAgB,EAExB,CAAC,EAQD,SAASC,GAAkB,CAEzB,QADIC,EAAQ,SAAS,qBAAqB,GAAG,EACpCC,EAAE,EAAGA,EAAED,EAAM,OAAQC,IAAI,CAChC,IAAIC,EAAOF,EAAMC,CAAC,EAAE,aAAa,MAAM,EAE/BE,EAASD,EAAK,UAAU,EAAGA,EAAK,MAAM,EAC1CF,EAAMC,CAAC,EAAE,aAAa,UAAW,kBAAqBE,EAAS,IAAK,EACpEH,EAAMC,CAAC,EAAE,aAAa,OAAQ,oBAAoB,CAEtD,CAEF,CAIF,SAASG,GAAc,CAKnBC,EAAY,SAAS,cAAc,QAAQ,EAC3CA,EAAU,MAAM,QAAU,OAC1BA,EAAU,YAAY,EAAE,eAAe,CAAC,EACxC,SAAS,qBAAqB,MAAM,EAAE,CAAC,EAAE,YAAYA,CAAS,EAG9D,EAAEA,CAAS,EAAE,MAAMN,CAAe,CACtC",
  "names": ["footnotePopup", "footnotePopupContent", "biblFrame", "closer", "x", "links", "i", "addBiblFrame", "e", "setupBiblPopups", "links", "i", "href", "biblId", "addBiblFrame", "biblFrame"]
}
